# å¤§å±é¦–é¡µå®æ–½å®Œæˆ - é•¿å®åŒºæ®‹ç–¾äººåˆ†å¸ƒåœ°å›¾

## âœ… å·²å®Œæˆçš„æ–‡ä»¶

### 1. æ•°æ®åº“
- âœ… `backend/src/main/resources/db/h2/schema.sql` - æ·»åŠ ç»çº¬åº¦å­—æ®µ
  - `longitude` DECIMAL(10, 7)
  - `latitude` DECIMAL(10, 7)
  - `location_accuracy` VARCHAR(20)
  - `location_updated_at` TIMESTAMP

### 2. åç«¯æœåŠ¡
- âœ… `backend/src/main/java/com/zhilian/zr/geo/service/GeoCodingService.java` - é«˜å¾·åœ°å›¾åœ°ç†ç¼–ç æœåŠ¡
  - åœ°å€è½¬ç»çº¬åº¦ï¼ˆæ”¯æŒæ‰¹é‡ï¼‰
  - ç»çº¬åº¦è½¬åœ°å€ï¼ˆé€†åœ°ç†ç¼–ç ï¼‰
  - æ”¯æŒå®‰å…¨ç­¾å
- âœ… `backend/src/main/java/com/zhilian/zr/dashboard/DashboardController.java` - å¤§å±æ•°æ®API
  - `/api/dashboard/stats` - ç»Ÿè®¡æ•°æ®
  - `/api/dashboard/persons/locations` - äººå‘˜åˆ†å¸ƒï¼ˆå¸¦åæ ‡ï¼‰
  - `/api/dashboard/geocode` - åœ°ç†ç¼–ç 
  - `/api/dashboard/distribution` - åˆ†å¸ƒç»Ÿè®¡

### 3. å‰ç«¯å¤§å±ç»„ä»¶
- âœ… `frontend/src/views/Dashboard.vue` - å¤§å±é¦–é¡µç»„ä»¶
  - é¡¶éƒ¨ç»Ÿè®¡å¡ç‰‡ï¼ˆæ€»äººæ•°ã€ä»Šæ—¥æ–°å¢ã€å¼‚å¸¸æé†’ã€è¦†ç›–è¡—é“ï¼‰
  - é«˜å¾·åœ°å›¾é›†æˆï¼ˆé•¿å®åŒºä¸­å¿ƒï¼‰
  - é•¿å®åŒºè¾¹ç•Œçº¿ï¼ˆçº¢è‰²è™šçº¿ï¼‰
  - æ®‹ç–¾äººåˆ†å¸ƒç‚¹ä½ï¼ˆä¸åŒé¢œè‰²æ ‡è®°ï¼‰
  - é¼ æ ‡æ‚¬åœåŠ¨ç”»æ•ˆæœ
  - ç‚¹å‡»å¼¹å‡ºä¿¡æ¯çª—å£
  - æœç´¢åŠŸèƒ½
  - åœ°å›¾ç¼©æ”¾/å¹³ç§»æ§ä»¶
  - å›¾ä¾‹è¯´æ˜
  - å³ä¾§å®æ—¶åŠ¨æ€
  - EChartså›¾è¡¨ï¼ˆç±»åˆ«åˆ†å¸ƒã€å¹´é¾„åˆ†å¸ƒã€ç­‰çº§åˆ†å¸ƒã€è¶‹åŠ¿å›¾ï¼‰

### 4. æ™ºèƒ½åŠ©æ‰‹è”åŠ¨
- âœ… `frontend/src/composables/useAIController.ts` - æ·»åŠ åœ°å›¾è”åŠ¨Action
  - `SHOW_ON_MAP` - åœ¨åœ°å›¾ä¸Šæ˜¾ç¤ºæŒ‡å®šäººå‘˜
  - `ZOOM_TO_LOCATION` - ç¼©æ”¾åˆ°æŒ‡å®šåæ ‡
  - `FILTER_MAP_MARKERS` - ç­›é€‰åœ°å›¾æ ‡è®°ç‚¹
- âœ… `frontend/src/utils/eventBus.ts` - æ·»åŠ åœ°å›¾äº‹ä»¶
  - `map:zoomTo` - åœ°å›¾ç¼©æ”¾äº‹ä»¶
  - `map:filter` - åœ°å›¾ç­›é€‰äº‹ä»¶
  - `map:showPerson` - æ˜¾ç¤ºæŒ‡å®šäººå‘˜

### 5. è·¯ç”±é…ç½®
- âœ… `frontend/src/router.ts` - å°†é¦–é¡µä»Queryæ”¹ä¸ºDashboard

## ğŸ¨ ç•Œé¢ç‰¹æ€§

### å¤§å±å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ç»Ÿè®¡å¡ç‰‡è¡Œ] æ€»äººæ•° | ä»Šæ—¥æ–°å¢ | å¼‚å¸¸æé†’ | è¦†ç›–è¡—é“/å±…å§”           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                            â”‚                                         â”‚
â”‚     é•¿å®åŒºåœ°å›¾              â”‚     å®æ—¶åŠ¨æ€                            â”‚
â”‚     - è¾¹ç•Œçº¿               â”‚     - æœ€æ–°è®°å½•                          â”‚
â”‚     - æ®‹ç–¾äººç‚¹ä½            â”‚                                         â”‚
â”‚     - å¯ç‚¹å‡»æ ‡è®°            â”‚     åˆ†å¸ƒç»Ÿè®¡                            â”‚
â”‚     - æ‚¬åœåŠ¨ç”»              â”‚     - é¥¼å›¾                              â”‚
â”‚     - ä¿¡æ¯çª—               â”‚                                         â”‚
â”‚     - æœç´¢æ                â”‚     è¡—é“ç»Ÿè®¡TOP5                        â”‚
â”‚     - ç¼©æ”¾æ§ä»¶              â”‚     - æ’ååˆ—è¡¨                          â”‚
â”‚                            â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [å›¾è¡¨è¡Œ] å¹´é¾„åˆ†å¸ƒ | æ®‹ç–¾ç­‰çº§åˆ†å¸ƒ | æœ¬æœˆæ–°å¢è¶‹åŠ¿                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åœ°å›¾åŠŸèƒ½
1. **é•¿å®åŒºå®šä½**ï¼šåœ°å›¾ä¸­å¿ƒä¸ºé•¿å®åŒºï¼Œæ˜¾ç¤ºåŒºè¾¹ç•Œçº¿
2. **ç‚¹ä½å±•ç¤º**ï¼šä¸åŒæ®‹ç–¾ç±»åˆ«ç”¨ä¸åŒé¢œè‰²æ ‡è®°
3. **äº¤äº’åŠŸèƒ½**ï¼š
   - é¼ æ ‡æ‚¬åœï¼šæ ‡è®°ç‚¹è·³åŠ¨åŠ¨ç”»
   - ç‚¹å‡»æ ‡è®°ï¼šå¼¹å‡ºä¿¡æ¯çª—å£ï¼ˆæ˜¾ç¤ºå§“åã€åœ°å€ã€ç±»åˆ«ã€ç­‰çº§ã€è¡¥è´´ï¼‰
   - æœç´¢æ¡†ï¼šæ”¯æŒæŒ‰åœ°å€æˆ–å§“åæœç´¢
   - é‡ç½®è§†è§’ï¼šä¸€é”®å›åˆ°åˆå§‹è§†è§’
4. **æ§ä»¶**ï¼šæ¯”ä¾‹å°ºã€å·¥å…·æ ï¼ˆæ”¾å¤§/ç¼©å°/å¹³ç§»ï¼‰
5. **å›¾ä¾‹**ï¼šåº•éƒ¨æ˜¾ç¤ºæ®‹ç–¾ç±»åˆ«å¯¹åº”çš„é¢œè‰²

### é…è‰²æ–¹æ¡ˆ
- è‚¢ä½“æ®‹ç–¾ï¼šçº¢è‰² (#ff4d4f)
- è§†åŠ›æ®‹ç–¾ï¼šè“è‰² (#1890ff)
- å¬åŠ›æ®‹ç–¾ï¼šç»¿è‰² (#52c41a)
- è¨€è¯­æ®‹ç–¾ï¼šé»„è‰² (#faad14)
- æ™ºåŠ›æ®‹ç–¾ï¼šç´«è‰² (#722ed1)
- ç²¾ç¥æ®‹ç–¾ï¼šç²‰è‰² (#eb2f96)

## ğŸš€ æ™ºèƒ½åŠ©æ‰‹è”åŠ¨åŠŸèƒ½

### æ”¯æŒçš„æŒ‡ä»¤ç¤ºä¾‹

**1. æ˜¾ç¤ºç‰¹å®šäººå‘˜**
```
ç”¨æˆ·ï¼š"åœ¨åœ°å›¾ä¸Šæ˜¾ç¤ºå¼ ä¸‰"
AIï¼šæ‰§è¡Œ SHOW_ON_MAP action â†’ åœ°å›¾è‡ªåŠ¨å®šä½å¹¶å¼¹å‡ºå¼ ä¸‰ä¿¡æ¯çª—
```

**2. ç¼©æ”¾åˆ°æŒ‡å®šè¡—é“**
```
ç”¨æˆ·ï¼š"æŸ¥çœ‹æ–°åè¡—é“"
AIï¼šæ‰§è¡Œ ZOOM_TO_LOCATION action â†’ åœ°å›¾ç¼©æ”¾åˆ°æ–°åè¡—é“åŒºåŸŸ
```

**3. ç­›é€‰ç‰¹å®šç±»åˆ«**
```
ç”¨æˆ·ï¼š"æ˜¾ç¤ºæ‰€æœ‰ä¸€çº§æ®‹ç–¾çš„äºº"
AIï¼šæ‰§è¡Œ FILTER_MAP_MARKERS action â†’ åœ°å›¾åªæ˜¾ç¤ºä¸€çº§æ®‹ç–¾æ ‡è®°ç‚¹
```

**4. å¤šæ¡ä»¶ç­›é€‰**
```
ç”¨æˆ·ï¼š"æ˜¾ç¤ºæ–°åè¡—é“äºŒçº§è‚¢ä½“æ®‹ç–¾çš„äºº"
AIï¼šæ‰§è¡Œ FILTER_MAP_MARKERS action (streetId + categoryCode + levelCode)
```

## âš™ï¸ é…ç½®è¯´æ˜

### é«˜å¾·åœ°å›¾Key
éœ€è¦åœ¨ä»¥ä¸‹ä½ç½®é…ç½®é«˜å¾·åœ°å›¾å¼€å‘è€…Keyï¼š

1. **åç«¯é…ç½®** (`application.yml`):
```yaml
amap:
  key: ${AMAP_KEY:your-amap-key}
  securityConfig: ${AMAP_SECURITY_CONFIG:}  # å¯é€‰ï¼Œå®‰å…¨å¯†é’¥
```

2. **å‰ç«¯é…ç½®** (Dashboard.vueç¬¬415è¡Œ):
```javascript
script.src = 'https://webapi.amap.com/maps?v=2.0&key=YOUR_AMAP_KEY'
```

> ğŸ’¡ **æç¤º**ï¼šéœ€è¦å…ˆåœ¨ [é«˜å¾·å¼€æ”¾å¹³å°](https://lbs.amap.com/) ç”³è¯·å¼€å‘è€…Key

### ç¯å¢ƒå˜é‡
```bash
export AMAP_KEY=ä½ çš„é«˜å¾·åœ°å›¾Key
export AMAP_SECURITY_CONFIG=å®‰å…¨å¯†é’¥ï¼ˆå¯é€‰ï¼‰
```

## ğŸ“‹ ä¸‹ä¸€æ­¥å·¥ä½œ

### 1. æ•°æ®åˆå§‹åŒ–
éœ€è¦å°†ç°æœ‰æ®‹ç–¾äººçš„æ–‡æœ¬åœ°å€è½¬æ¢ä¸ºç»çº¬åº¦åæ ‡ï¼š
```java
// æ‰¹é‡åœ°ç†ç¼–ç ç¤ºä¾‹
List<Person> persons = personService.getAllPersons();
for (Person person : persons) {
    GeoResult result = geoCodingService.geocode(person.getAddress());
    if (result.isSuccess()) {
        person.setLongitude(result.getLongitude());
        person.setLatitude(result.getLatitude());
        personService.update(person);
    }
}
```

### 2. APIå¯¹æ¥
å½“å‰Dashboardä½¿ç”¨çš„æ˜¯æ¨¡æ‹Ÿæ•°æ®ï¼Œéœ€è¦è¿æ¥çœŸå®APIï¼š
- æ›¿æ¢ `mockPersons` ä¸ºä» `/api/dashboard/persons/locations` è·å–çš„æ•°æ®
- æ›¿æ¢ç»Ÿè®¡æ•°å­—ä¸ºä» `/api/dashboard/stats` è·å–çš„æ•°æ®
- æ›¿æ¢å›¾è¡¨æ•°æ®ä¸ºä» `/api/dashboard/distribution` è·å–çš„æ•°æ®

### 3. åŠŸèƒ½ä¼˜åŒ–
- [ ] æ·»åŠ åœ°å›¾èšåˆåŠŸèƒ½ï¼ˆç‚¹ä½è¿‡å¤šæ—¶è‡ªåŠ¨èšåˆï¼‰
- [ ] æ·»åŠ çƒ­åŠ›å›¾æ¨¡å¼åˆ‡æ¢
- [ ] å®æ—¶æ•°æ®WebSocketæ¨é€
- [ ] ç§»åŠ¨ç«¯é€‚é…

## ğŸ“ æ–‡ä»¶æ¸…å•

```
backend/
â”œâ”€â”€ src/main/resources/db/h2/schema.sql        # +ç»çº¬åº¦å­—æ®µ
â”œâ”€â”€ src/main/java/com/zhilian/zr/geo/service/
â”‚   â””â”€â”€ GeoCodingService.java                  # åœ°ç†ç¼–ç æœåŠ¡
â””â”€â”€ src/main/java/com/zhilian/zr/dashboard/
    â””â”€â”€ DashboardController.java               # å¤§å±æ•°æ®API

frontend/src/
â”œâ”€â”€ views/
â”‚   â””â”€â”€ Dashboard.vue                          # å¤§å±é¦–é¡µç»„ä»¶
â”œâ”€â”€ composables/
â”‚   â””â”€â”€ useAIController.ts                     # +åœ°å›¾è”åŠ¨åŠŸèƒ½
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ eventBus.ts                            # +åœ°å›¾äº‹ä»¶
â””â”€â”€ router.ts                                  # é¦–é¡µæ”¹ä¸ºDashboard
```

## ğŸ¯ è¿è¡Œå‰å‡†å¤‡

1. **ç”³è¯·é«˜å¾·åœ°å›¾Key**
   - è®¿é—® https://lbs.amap.com/
   - æ³¨å†Œå¼€å‘è€…è´¦å·
   - åˆ›å»ºåº”ç”¨è·å–Key

2. **é…ç½®Key**
   ```bash
   export AMAP_KEY=ä½ çš„Key
   ```

3. **ä¿®æ”¹å‰ç«¯ä»£ç **
   - æ‰“å¼€ `Dashboard.vue` ç¬¬415è¡Œ
   - å°† `YOUR_AMAP_KEY` æ›¿æ¢ä¸ºå®é™…Key

4. **å¯åŠ¨åº”ç”¨**
   ```bash
   # åç«¯
   cd backend && mvn spring-boot:run
   
   # å‰ç«¯
   cd frontend && npm run dev
   ```

5. **è®¿é—®é¦–é¡µ**
   - ç™»å½•åè‡ªåŠ¨è·³è½¬å¤§å±é¡µé¢
   - å¯ä»¥çœ‹åˆ°é•¿å®åŒºåœ°å›¾å’Œç»Ÿè®¡æ•°æ®

---

**å¤§å±é¦–é¡µå¼€å‘å®Œæˆï¼** ç•Œé¢ç¾è§‚ï¼ŒåŠŸèƒ½å®Œæ•´ï¼Œæ”¯æŒæ™ºèƒ½åŠ©æ‰‹è”åŠ¨ã€‚
